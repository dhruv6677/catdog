<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Object Classification</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="shortcut icon" />
	<style>
		#loading {
			position: fixed;
			inset: 0;
			z-index: 50;
			background: rgba(255, 255, 255, 0.7);
			display: none;
		}

		.loader {
			border: 8px solid #f3f3f3;
			border-top: 8px solid #1b2d6b;
			border-radius: 50%;
			width: 60px;
			height: 60px;
			animation: spin 1.5s linear infinite;
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
		}

		@keyframes spin {
			0% {
				transform: translate(-50%, -50%) rotate(0deg);
			}

			100% {
				transform: translate(-50%, -50%) rotate(360deg);
			}
		}
	</style>
</head>

<body class="bg-gray-100 font-sans">
	<div class="max-w-6xl mx-auto py-10">
		<h1 class="text-3xl font-bold text-center text-indigo-800 mb-8">
			Object Classification
		</h1>

		<div class="grid md:grid-cols-2 gap-8">
			
			<div class="flex flex-col items-center">
				<div
					class="relative border border-indigo-700 w-72 h-72 flex justify-center items-center rounded-lg bg-white shadow-md">
					<video autoplay id="video" class="w-full h-full object-cover p-2 rounded-lg"
						poster="https://img.freepik.com/free-vector/group-young-people-posing-photo_52683-18824.jpg?size=338&ext=jpg"></video>
					<img src="" id="photo" class="absolute w-full h-full object-cover p-2 hidden rounded-lg" />
					<canvas id="canvas" class="hidden"></canvas>
				</div>

				<div class="mt-5 w-80">
					<div class="flex justify-between space-x-4">
						<button type="button" id="uload"
							class="w-1/2 bg-indigo-700 hover:bg-indigo-800 text-white py-2 rounded-lg transition">
							Upload
						</button>
						<button type="button" id="send"
							class="w-1/2 bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg transition">
							Predict
						</button>
					</div>
					<input type="file" id="fileinput" class="hidden" />
					<input type="hidden" id="url" value="../predict" />
				</div>
			</div>

			
			<div class="bg-white border border-gray-300 rounded-lg shadow-md p-5">
				<h2 class="text-lg font-semibold text-center text-indigo-700 mb-3">
					Prediction Results
				</h2>

				<div class="grid grid-cols-2 gap-4">
					<div
						class="border border-gray-200 p-2 rounded-lg h-80 overflow-hidden flex justify-center items-center bg-gray-50 res-part2">
					</div>
					<div class="border border-gray-200 p-2 rounded-lg h-80 overflow-auto bg-gray-50 res-part">
						<div class="jsonRes text-sm font-mono whitespace-pre-wrap"></div>
					</div>
				</div>
			</div>
		</div>
	</div>

	
	<div id="loading">
		<div class="loader"></div>
	</div>

	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script>
		var myvideo = document.getElementById('video');
		var myphoto = document.getElementById('photo');
		var base_data = "";

		function sendRequest(base64Data) {
			if (base64Data) {
				var url = $("#url").val();
				$("#loading").show();
				$.ajax({
					url: url,
					type: "POST",
					cache: false,
					async: true,
					crossDomain: true,
					headers: {
						"Content-Type": "application/json",
						"Access-Control-Allow-Origin": "*",
					},
					data: JSON.stringify({ image: base64Data }),
					success: function (res) {
						$(".res-part").html("");
						$(".res-part2").html("");
						try {
							var imageData = res[1].image;
							if (imageData && imageData.length > 100) {
								$(".res-part2").append(
									"<img class='rounded-lg object-cover h-72' src='data:image/jpeg;base64," +
									imageData +
									"' alt='' />"
								);
							}
						} catch (e) { }
						$(".res-part").html(
							"<pre>" + JSON.stringify(res[0], undefined, 2) + "</pre>"
						);
						$("#loading").hide();
					},
					error: function () {
						$("#loading").hide();
						alert("Prediction request failed. Check API endpoint.");
					},
				});
			}
		}

		$(document).ready(function () {
			$("#loading").hide();

			$("#send").click(function () {
				sendRequest(base_data);
			});

			$("#uload").click(function () {
				$("#fileinput").trigger("click");
			});

			$("#fileinput").change(function () {
				if (this.files && this.files[0]) {
					var reader = new FileReader();
					reader.onload = function (e) {
						var url = e.target.result;
						var img = new Image();
						img.crossOrigin = "Anonymous";
						img.onload = function () {
							var canvas = document.createElement("canvas");
							var ctx = canvas.getContext("2d");
							canvas.height = this.height;
							canvas.width = this.width;
							ctx.drawImage(this, 0, 0);
							base_data = canvas
								.toDataURL("image/jpeg", 1.0)
								.replace(/^data:image.+;base64,/, "");
							canvas = null;
						};
						img.src = url;
						$("#photo").attr("src", url).show();
						$("#video").hide();
					};
					reader.readAsDataURL(this.files[0]);
				}
			});
		});
	</script>
</body>

</html> 